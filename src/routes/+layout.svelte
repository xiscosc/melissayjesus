<script lang="ts">
	import '../app.css';
	import { onMount } from 'svelte';

	let { children } = $props();
	let scrollY = $state(0);
	let mobileMenuOpen = $state(false);
	let headerEl: HTMLElement;

	onMount(() => {
		const updateScroll = () => (scrollY = window.scrollY);
		window.addEventListener('scroll', updateScroll);

		// Close mobile menu when clicking outside
		const handleClickOutside = (event: MouseEvent) => {
			if (mobileMenuOpen && headerEl && !headerEl.contains(event.target as Node)) {
				mobileMenuOpen = false;
			}
		};

		// Use a slight delay to avoid conflicts with the toggle button
		const delayedClickHandler = (event: MouseEvent) => {
			setTimeout(() => handleClickOutside(event), 0);
		};

		document.addEventListener('click', delayedClickHandler);

		return () => {
			window.removeEventListener('scroll', updateScroll);
			document.removeEventListener('click', delayedClickHandler);
		};
	});

	function toggleMobileMenu(event: Event) {
		event.stopPropagation();
		mobileMenuOpen = !mobileMenuOpen;
	}

	function closeMobileMenu() {
		mobileMenuOpen = false;
	}

	function scrollToSection(sectionId: string) {
		const element = document.getElementById(sectionId);
		if (element) {
			element.scrollIntoView({ behavior: 'smooth', block: 'start' });
		}
		closeMobileMenu();
	}
</script>

<svelte:window bind:scrollY />

<header
	bind:this={headerEl}
	class="fixed top-0 right-0 left-0 z-50 transition-all duration-500 ease-out {scrollY > 50
		? 'py-2'
		: 'py-4'}"
>
	<div class="mx-auto max-w-7xl px-6">
		<nav
			class="relative rounded-lg border-2 border-[#212E21] bg-[#869782] px-6 py-3 shadow-lg transition-all duration-500 ease-out"
		>
			<div class="flex items-center justify-between">
				<div
					class="cursor-pointer font-sans text-2xl font-black tracking-tight text-[#212E21] md:hidden"
					onclick={toggleMobileMenu}
				>
					Men√∫
				</div>

				<!-- Desktop icon -->
				<div class="hidden md:block">
					<svg class="h-8 w-8" stroke="currentColor" viewBox="0 0 577 571.25">
						<path
							d="M15,140.712644 C15,140.712644 47.491438,121.885057 62.1351161,113.517241 C76.7787943,105.149425 72.5948862,98.8735632 78.8707483,96.7816092 C87.2385644,86.3218391 109.204082,80.045977 122.801783,80.045977 C142.675346,80.045977 142.675346,80.0459768 151.043162,85.2758621 C159.315443,92.6618275 162.548909,104.103448 167.778794,116.655172 C192.882243,149.08046 197.066151,180.45977 204.38799,188.827586 C230.537415,201.37931 216.789953,198.032525 235.7673,205.563218 C254.744647,213.093912 261.916725,216.022989 279.698335,218.114943 C297.479944,220.206897 460.652358,228.574713 479.479944,228.574713 C496.215576,230.666667 507.721323,244.264368 512.951208,249.494253 C518.181093,254.724138 519.22707,263.091954 521.319024,277.735632 C523.410978,292.37931 529.68684,302.83908 539.100633,313.298851 C542.964572,313.298851 545.376495,315.390805 549.560403,316.436782 C553.744312,317.482759 560.020174,318.64194 560.020174,320.62069 C560.966875,321.567391 561.066151,333.172414 556.882243,340.494253 C551.652358,363.505747 559.989816,385.593617 555.836266,392.793103 C551.682716,399.99259 527.594886,399.068966 524.456955,392.793103 C521.319024,386.517241 535.962702,381.287356 537.008679,377.103448 C538.054656,372.91954 532.824771,347.816092 532.824771,341.54023 C532.824771,335.264368 528.640863,334.218391 525.502932,333.172414 C522.365001,332.126437 518.181093,335.264368 501.445461,335.264368 C487.03607,335.591854 470.066151,324.804598 459.606381,322.712644 C449.14661,320.62069 435.548909,321.666667 395.801783,318.528736 C372.160252,321.310092 347.696087,325.539843 326.7673,333.172414 C300.472304,342.762 274.390299,355.946192 228.37931,358.275862 M193.92822,346.770115 C193.92822,346.770115 152.019801,322.148952 138.491438,304.931034 C124.963075,287.713117 122.801783,272.505747 122.801783,261 C122.801783,249.494253 130.123622,237.988506 124.893737,221.252874 C119.663852,204.517241 117.571898,173.137931 109.204082,164.770115 C91.4224725,157.448276 53.7673,164.770115 39.1236219,162.678161 C25.5259207,157.448276 15.0661506,148.034483 16.045977,138.62069"
							stroke-width="5"
						/>
						<path
							d="M30.1578987,142.540518 C31.2404285,137.723482 35.3877838,135.218679 31.2038758,133.126725 C28.0659447,135.218679 16.5601976,141.494541 16.5601976,141.494541 C16.5601976,141.494541 19.6981286,150.908334 23.8820367,153.000288 C28.627427,153.531355 29.075369,147.357555 30.1578987,142.540518 Z"
							stroke-width="10"
							fill="currentColor"
						/>
						<path
							d="M120.899976,79.4846476 C120.91697,80.4874738 118.691245,83.3147451 117.634932,87.2354463 C116.587995,91.1561475 117.881053,99.2693608 117.983604,104.283492 C118.086154,109.297623 110.560697,116.686007 110.704267,121.700138 C110.847838,126.714269 108.588165,141.259767 109.326488,147.592412 C110.057343,153.925057 110.565173,154.931627 114.914534,159.076519 C119.22823,163.22141 123.35625,162.809826 126.48124,162.078811 C129.613262,161.347796 140.046342,155.207691 145.431589,151.675762 C150.864084,148.143832 152.977557,145.290204 155.19332,141.460106 C157.427835,137.630009 158.041063,130.673533 159.849285,126.780128 C161.672363,122.886722 164.013446,121.745629 165.54574,119.210536 C167.086249,116.675443 168.758619,119.210535 168.758619,119.210535"
							stroke-width="5"
						/>
						<path
							d="M167.712644,295.517241 C167.712644,295.517241 180.17518,300.066608 186.54023,305.977011 C192.90528,311.887415 194.253758,311.727676 197,322.712644 C199.746242,333.697611 194.908046,341.54023 194.908046,347.816092 C194.908046,354.091954 198.823397,353.342787 197,362.45977 C195.176603,371.576754 193.093206,375.673543 188.632184,379.195402 C184.171162,382.717262 179.218391,378.149425 170.850575,381.287356 C160.390804,388.609195 155.16092,390.701149 160.390804,393.83908 C171.896552,395.931034 191.523339,396.700195 200.137932,395.931034 C209.551725,388.609195 214.889329,390.408149 218.965518,386.517241 C223.041707,382.626334 220.257894,384.24652 223.149425,373.965517 C226.040957,363.684515 224.240434,373.740358 228.37931,353.045977 C232.518187,332.351596 234.609603,322.48621 235.701149,311.206897 C236.792696,299.927583 238.185919,295.509091 234.655172,288.195402 C231.124426,280.881713 221.057471,280.873563 221.057471,280.873563"
							stroke-width="5"
						/>
						<path
							d="M53.7011494,162.678161 C65.2068966,158.494252 64.2766999,155.624724 69.3908046,153.264368 C74.5049093,150.904012 77.7586207,150.126437 81.9425287,150.126437 C86.1264368,150.126437 94.4942529,150.126437 94.4942529,150.126437"
							stroke-width="5"
						/>
						<path
							d="M94.3160981,106.313318 C93.7826001,103.698549 90.3061655,102.704471 86.5512641,104.092983 C82.7963626,105.481494 80.184899,107.871617 80.7183969,109.431471 C81.2518948,110.991325 84.7283294,111.985403 88.4832309,111.651806 C92.2381324,111.318209 94.849596,108.928086 94.3160981,106.313318 Z"
							stroke-width="5"
						/>
					</svg>
				</div>

				<div class="hidden items-center space-x-1 md:flex">
					<button
						onclick={() => scrollToSection('home')}
						class="relative rounded-md px-4 py-2 font-sans text-sm font-bold tracking-wide text-[#212E21] transition-all duration-300 hover:bg-[#212E21]/10 hover:text-[#212E21]"
					>
						Inicio
					</button>
					<button
						onclick={() => scrollToSection('venue')}
						class="relative rounded-md px-4 py-2 font-sans text-sm font-bold tracking-wide text-[#212E21] transition-all duration-300 hover:bg-[#212E21]/10 hover:text-[#212E21]"
					>
						Lugar
					</button>
					<button
						onclick={() => scrollToSection('transport')}
						class="relative rounded-md px-4 py-2 font-sans text-sm font-bold tracking-wide text-[#212E21] transition-all duration-300 hover:bg-[#212E21]/10 hover:text-[#212E21]"
					>
						Transporte
					</button>
					<button
						onclick={() => scrollToSection('present')}
						class="relative rounded-md px-4 py-2 font-sans text-sm font-bold tracking-wide text-[#212E21] transition-all duration-300 hover:bg-[#212E21]/10 hover:text-[#212E21]"
					>
						Crowdfunding
					</button>
					<button
						onclick={() => scrollToSection('event')}
						class="relative rounded-md px-4 py-2 font-sans text-sm font-bold tracking-wide text-[#212E21] transition-all duration-300 hover:bg-[#212E21]/10 hover:text-[#212E21]"
					>
						Evento
					</button>
					<button
						onclick={() => scrollToSection('rsvp')}
						class="relative rounded-md border-2 border-[#212E21] bg-[#751F19] px-4 py-2 font-sans text-sm font-bold tracking-wide text-[#E8DEC9] transition-all duration-300 hover:bg-[#751F19]/80"
					>
						Confirmar
					</button>
				</div>

				<!-- Mobile menu button -->
				<button
					onclick={toggleMobileMenu}
					class="rounded-md p-2 text-[#212E21] transition-colors duration-300 hover:bg-[#212E21]/10 md:hidden"
					aria-label="Toggle menu"
				>
					{#if mobileMenuOpen}
						<svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
							<path
								stroke-linecap="round"
								stroke-linejoin="round"
								stroke-width="2"
								d="M6 18L18 6M6 6l12 12"
							></path>
						</svg>
					{:else}
						<svg class="h-6 w-6" stroke="currentColor" viewBox="0 0 577 571.25">
							<path
								d="M15,140.712644 C15,140.712644 47.491438,121.885057 62.1351161,113.517241 C76.7787943,105.149425 72.5948862,98.8735632 78.8707483,96.7816092 C87.2385644,86.3218391 109.204082,80.045977 122.801783,80.045977 C142.675346,80.045977 142.675346,80.0459768 151.043162,85.2758621 C159.315443,92.6618275 162.548909,104.103448 167.778794,116.655172 C192.882243,149.08046 197.066151,180.45977 204.38799,188.827586 C230.537415,201.37931 216.789953,198.032525 235.7673,205.563218 C254.744647,213.093912 261.916725,216.022989 279.698335,218.114943 C297.479944,220.206897 460.652358,228.574713 479.479944,228.574713 C496.215576,230.666667 507.721323,244.264368 512.951208,249.494253 C518.181093,254.724138 519.22707,263.091954 521.319024,277.735632 C523.410978,292.37931 529.68684,302.83908 539.100633,313.298851 C542.964572,313.298851 545.376495,315.390805 549.560403,316.436782 C553.744312,317.482759 560.020174,318.64194 560.020174,320.62069 C560.966875,321.567391 561.066151,333.172414 556.882243,340.494253 C551.652358,363.505747 559.989816,385.593617 555.836266,392.793103 C551.682716,399.99259 527.594886,399.068966 524.456955,392.793103 C521.319024,386.517241 535.962702,381.287356 537.008679,377.103448 C538.054656,372.91954 532.824771,347.816092 532.824771,341.54023 C532.824771,335.264368 528.640863,334.218391 525.502932,333.172414 C522.365001,332.126437 518.181093,335.264368 501.445461,335.264368 C487.03607,335.591854 470.066151,324.804598 459.606381,322.712644 C449.14661,320.62069 435.548909,321.666667 395.801783,318.528736 C372.160252,321.310092 347.696087,325.539843 326.7673,333.172414 C300.472304,342.762 274.390299,355.946192 228.37931,358.275862 M193.92822,346.770115 C193.92822,346.770115 152.019801,322.148952 138.491438,304.931034 C124.963075,287.713117 122.801783,272.505747 122.801783,261 C122.801783,249.494253 130.123622,237.988506 124.893737,221.252874 C119.663852,204.517241 117.571898,173.137931 109.204082,164.770115 C91.4224725,157.448276 53.7673,164.770115 39.1236219,162.678161 C25.5259207,157.448276 15.0661506,148.034483 16.045977,138.62069"
								stroke-width="5"
							/>
							<path
								d="M30.1578987,142.540518 C31.2404285,137.723482 35.3877838,135.218679 31.2038758,133.126725 C28.0659447,135.218679 16.5601976,141.494541 16.5601976,141.494541 C16.5601976,141.494541 19.6981286,150.908334 23.8820367,153.000288 C28.627427,153.531355 29.075369,147.357555 30.1578987,142.540518 Z"
								stroke-width="10"
								fill="currentColor"
							/>
							<path
								d="M120.899976,79.4846476 C120.91697,80.4874738 118.691245,83.3147451 117.634932,87.2354463 C116.587995,91.1561475 117.881053,99.2693608 117.983604,104.283492 C118.086154,109.297623 110.560697,116.686007 110.704267,121.700138 C110.847838,126.714269 108.588165,141.259767 109.326488,147.592412 C110.057343,153.925057 110.565173,154.931627 114.914534,159.076519 C119.22823,163.22141 123.35625,162.809826 126.48124,162.078811 C129.613262,161.347796 140.046342,155.207691 145.431589,151.675762 C150.864084,148.143832 152.977557,145.290204 155.19332,141.460106 C157.427835,137.630009 158.041063,130.673533 159.849285,126.780128 C161.672363,122.886722 164.013446,121.745629 165.54574,119.210536 C167.086249,116.675443 168.758619,119.210535 168.758619,119.210535"
								stroke-width="5"
							/>
							<path
								d="M167.712644,295.517241 C167.712644,295.517241 180.17518,300.066608 186.54023,305.977011 C192.90528,311.887415 194.253758,311.727676 197,322.712644 C199.746242,333.697611 194.908046,341.54023 194.908046,347.816092 C194.908046,354.091954 198.823397,353.342787 197,362.45977 C195.176603,371.576754 193.093206,375.673543 188.632184,379.195402 C184.171162,382.717262 179.218391,378.149425 170.850575,381.287356 C160.390804,388.609195 155.16092,390.701149 160.390804,393.83908 C171.896552,395.931034 191.523339,396.700195 200.137932,395.931034 C209.551725,388.609195 214.889329,390.408149 218.965518,386.517241 C223.041707,382.626334 220.257894,384.24652 223.149425,373.965517 C226.040957,363.684515 224.240434,373.740358 228.37931,353.045977 C232.518187,332.351596 234.609603,322.48621 235.701149,311.206897 C236.792696,299.927583 238.185919,295.509091 234.655172,288.195402 C231.124426,280.881713 221.057471,280.873563 221.057471,280.873563"
								stroke-width="5"
							/>
							<path
								d="M53.7011494,162.678161 C65.2068966,158.494252 64.2766999,155.624724 69.3908046,153.264368 C74.5049093,150.904012 77.7586207,150.126437 81.9425287,150.126437 C86.1264368,150.126437 94.4942529,150.126437 94.4942529,150.126437"
								stroke-width="5"
							/>
							<path
								d="M94.3160981,106.313318 C93.7826001,103.698549 90.3061655,102.704471 86.5512641,104.092983 C82.7963626,105.481494 80.184899,107.871617 80.7183969,109.431471 C81.2518948,110.991325 84.7283294,111.985403 88.4832309,111.651806 C92.2381324,111.318209 94.849596,108.928086 94.3160981,106.313318 Z"
								stroke-width="5"
							/>
						</svg>
					{/if}
				</button>
			</div>

			<!-- Mobile menu dropdown -->
			{#if mobileMenuOpen}
				<div
					class="absolute top-full right-0 left-0 mx-4 mt-2 rounded-lg border-2 border-[#212E21] bg-[#869782] shadow-lg md:hidden"
					style="animation: slideDown 0.3s ease-out;"
				>
					<div class="space-y-1 p-4">
						<button
							onclick={() => scrollToSection('home')}
							class="block w-full rounded-md px-4 py-3 text-left font-sans text-base font-bold tracking-wide text-[#212E21] transition-colors duration-200 hover:bg-[#212E21]/10"
						>
							Inicio
						</button>
						<button
							onclick={() => scrollToSection('venue')}
							class="block w-full rounded-md px-4 py-3 text-left font-sans text-base font-bold tracking-wide text-[#212E21] transition-colors duration-200 hover:bg-[#212E21]/10"
						>
							Lugar
						</button>
						<button
							onclick={() => scrollToSection('transport')}
							class="block w-full rounded-md px-4 py-3 text-left font-sans text-base font-bold tracking-wide text-[#212E21] transition-colors duration-200 hover:bg-[#212E21]/10"
						>
							Transporte
						</button>
						<button
							onclick={() => scrollToSection('present')}
							class="block w-full rounded-md px-4 py-3 text-left font-sans text-base font-bold tracking-wide text-[#212E21] transition-colors duration-200 hover:bg-[#212E21]/10"
						>
							Crowdfunding
						</button>
						<button
							onclick={() => scrollToSection('event')}
							class="block w-full rounded-md px-4 py-3 text-left font-sans text-base font-bold tracking-wide text-[#212E21] transition-colors duration-200 hover:bg-[#212E21]/10"
						>
							Evento
						</button>
						<button
							onclick={() => scrollToSection('rsvp')}
							class="mt-4 block w-full rounded-md border-2 border-[#212E21] bg-[#751F19] px-4 py-3 text-left font-sans text-base font-bold tracking-wide text-[#E8DEC9] transition-colors duration-200 hover:bg-[#751F19]/80"
						>
							Confirmar
						</button>
					</div>
				</div>
			{/if}
		</nav>
	</div>
</header>

<main>
	{@render children()}
</main>

<style>
	@keyframes slideDown {
		from {
			opacity: 0;
			transform: translateY(-10px);
		}
		to {
			opacity: 1;
			transform: translateY(0);
		}
	}
</style>
